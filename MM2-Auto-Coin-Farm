local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- CONFIGURATION
local TARGET_NAME = "TargetPart" -- Change this to your object's name
local FLIGHT_SPEED = 70
local ROTATION_SPEED = 0.15 -- Lower = smoother turning

local isFlying = false
local bodyVelocity = nil
local bodyGyro = nil

--- ### 1. GUI CREATION ### ---
local screenGui = Instance.new("ScreenGui", player.PlayerGui)
screenGui.Name = "AutoFlightGui"

local toggleButton = Instance.new("TextButton", screenGui)
toggleButton.Size = UDim2.new(0, 150, 0, 50)
toggleButton.Position = UDim2.new(0.5, -75, 0.8, 0)
toggleButton.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Text = "Auto-Fly: OFF"
toggleButton.Font = Enum.Font.Offset
toggleButton.TextSize = 18

-- Rounding the corners
local uiCorner = Instance.new("UICorner", toggleButton)

--- ### 2. FLIGHT LOGIC ### ---

local function startFlight()
	local target = workspace:FindFirstChild(TARGET_NAME)
	if not target then warn("Target not found!") return end

	-- Setup Physics Objects
	bodyVelocity = Instance.new("BodyVelocity")
	bodyVelocity.MaxForce = Vector3.new(1, 1, 1) * math.huge
	bodyVelocity.Velocity = Vector3.zero
	bodyVelocity.Parent = hrp

	bodyGyro = Instance.new("BodyGyro")
	bodyGyro.MaxTorque = Vector3.new(1, 1, 1) * math.huge
	bodyGyro.P = 3000
	bodyGyro.CFrame = hrp.CFrame
	bodyGyro.Parent = hrp

	character.Humanoid.PlatformStand = true
	
	-- Movement Loop
	task.spawn(function()
		while isFlying do
			local targetObj = workspace:FindFirstChild(TARGET_NAME)
			if targetObj and hrp then
				local origin = hrp.Position
				local destination = targetObj.Position
				local direction = (destination - origin).Unit
				local distance = (destination - origin).Magnitude

				if distance > 5 then
					bodyVelocity.Velocity = direction * FLIGHT_SPEED
					-- Smoothly rotate to face target
					bodyGyro.CFrame = bodyGyro.CFrame:Lerp(CFrame.lookAt(origin, destination), ROTATION_SPEED)
				else
					bodyVelocity.Velocity = Vector3.zero
				end
			end
			task.wait()
		end
	end)
end

local function stopFlight()
	if bodyVelocity then bodyVelocity:Destroy() end
	if bodyGyro then bodyGyro:Destroy() end
	if character:FindFirstChild("Humanoid") then
		character.Humanoid.PlatformStand = false
	end
end

--- ### 3. TOGGLE INTERACTION ### ---

toggleButton.MouseButton1Click:Connect(function()
	isFlying = not isFlying
	
	if isFlying then
		toggleButton.Text = "Auto-Fly: ON"
		toggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
		startFlight()
	else
		toggleButton.Text = "Auto-Fly: OFF"
		toggleButton.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
		stopFlight()
	end
end)
